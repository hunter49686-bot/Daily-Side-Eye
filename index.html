<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Daily Side-Eye</title>
  <style>
    body { margin: 0; font-family: Arial, Helvetica, sans-serif; background: #ffffff; color: #111; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px 14px 30px; }
    .topbar { display: flex; align-items: flex-start; justify-content: space-between; gap: 18px; }
    h1 { margin: 0; font-size: 44px; letter-spacing: 0.5px; }
    .tagline { margin-top: 6px; color: #444; font-size: 18px; }
    .dateline { text-align: right; color: #444; font-size: 16px; line-height: 1.35; }
    .rule { height: 2px; background: #e5e5e5; margin: 12px 0 14px; }

    .last { color: #444; font-size: 16px; margin: 0 0 14px; }

    .columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 28px; }
    @media (max-width: 980px) { .columns { grid-template-columns: 1fr; } }

    .section { margin-bottom: 18px; }
    .section-title { font-weight: 800; font-size: 20px; letter-spacing: 1px; margin: 0 0 8px; }
    .section-rule { height: 2px; background: #e5e5e5; margin: 0 0 10px; }

    .item { margin: 10px 0 16px; }
    .headline-line { display: flex; flex-wrap: wrap; align-items: baseline; gap: 8px; }
    .badge { display: inline-block; font-size: 12px; border: 1px solid #bbb; border-radius: 999px; padding: 2px 8px; color: #444; background: #f7f7f7; }
    .ages { display: inline-block; font-size: 12px; border: 1px solid #c8a400; border-radius: 999px; padding: 2px 8px; color: #5a4a00; background: #fff7cc; }

    a.headline { color: #111; text-decoration: none; font-weight: 800; font-size: 22px; }
    a.headline:hover { text-decoration: underline; }
    a.feature { color: #b00000; font-size: 30px; }

    .source { color: #666; font-size: 16px; }
    .sub { color: #222; font-size: 16px; margin-top: 4px; }

    .meter { font-size: 14px; color: #666; letter-spacing: 1px; margin-left: 6px; }
    .meter b { color: #111; font-weight: 700; }

    .footer { margin-top: 26px; padding-top: 14px; border-top: 2px solid #e5e5e5; color: #333; }
    .footer h2 { margin: 0 0 10px; font-size: 20px; letter-spacing: 1px; }
    .footer ul { margin: 0; padding-left: 18px; }
    .footer li { margin: 6px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1 id="siteTitle">THE DAILY SIDE-EYE</h1>
        <div id="siteTagline" class="tagline">Headlines with a raised eyebrow.</div>
      </div>
      <div class="dateline" id="dateNow"></div>
    </div>

    <div class="rule"></div>
    <div class="last" id="lastUpdated">Last updated:</div>

    <div id="columns" class="columns"></div>

    <div class="footer">
      <h2>THE WEEK IN HINDSIGHT</h2>
      <ul id="weekList"></ul>
    </div>
  </div>

  <script>
    function fmtLocal(dt) {
      return dt.toLocaleString(undefined, { dateStyle: "medium", timeStyle: "short" });
    }

    function meterDots(score) {
      // score 1..5
      var filled = Math.max(1, Math.min(5, score || 1));
      var out = "";
      for (var i = 1; i <= 5; i++) out += (i <= filled) ? "o" : ".";
      return out;
    }

    async function loadHeadlines() {
      // cachebust so you always see latest
      var res = await fetch("headlines.json?cb=" + Date.now());
      var data = await res.json();

      var title = (data.site && data.site.name) ? data.site.name : "THE DAILY SIDE-EYE";
      var tagline = (data.site && data.site.tagline) ? data.site.tagline : "";
      document.getElementById("siteTitle").textContent = title;
      document.getElementById("siteTagline").textContent = tagline;

      var now = new Date();
      document.getElementById("dateNow").textContent = now.toLocaleString(undefined, { weekday: "long", year: "numeric", month: "long", day: "numeric" }) + "\n" +
                                                      now.toLocaleString(undefined, { hour: "numeric", minute: "2-digit" });

      if (data.generated_utc) {
        var gen = new Date(data.generated_utc);
        document.getElementById("lastUpdated").textContent = "Last updated: " + fmtLocal(gen);
      }

      var container = document.getElementById("columns");
      container.innerHTML = "";

      (data.columns || []).forEach(function(col) {
        var colDiv = document.createElement("div");

        (col.sections || []).forEach(function(sec) {
          var secDiv = document.createElement("div");
          secDiv.className = "section";

          var h = document.createElement("div");
          h.className = "section-title";
          h.textContent = String(sec.name || "").toUpperCase();
          secDiv.appendChild(h);

          var hr = document.createElement("div");
          hr.className = "section-rule";
          secDiv.appendChild(hr);

          (sec.items || []).forEach(function(it) {
            var itemDiv = document.createElement("div");
            itemDiv.className = "item";

            var line1 = document.createElement("div");
            line1.className = "headline-line";

            if (it.ages_poorly) {
              var ages = document.createElement("span");
              ages.className = "ages";
              ages.textContent = "IF THIS AGES POORLY";
              line1.appendChild(ages);
            }

            if (it.badge) {
              var badge = document.createElement("span");
              badge.className = "badge";
              badge.textContent = it.badge;
              line1.appendChild(badge);
            }

            var a = document.createElement("a");
            a.href = it.url;
            a.target = "_blank";
            a.rel = "noopener";
            a.className = it.feature ? "headline feature" : "headline";
            a.textContent = it.title || "";
            line1.appendChild(a);

            var src = document.createElement("span");
            src.className = "source";
            src.textContent = " (" + (it.source || "") + ")";
            line1.appendChild(src);

            // Side-Eye Meter
            var m = document.createElement("span");
            m.className = "meter";
            m.innerHTML = " <b>eye</b> " + meterDots(it.meter || 1);
            line1.appendChild(m);

            itemDiv.appendChild(line1);

            var sub = document.createElement("div");
            sub.className = "sub";
            sub.textContent = it.snark || "";
            itemDiv.appendChild(sub);

            secDiv.appendChild(itemDiv);
          });

          colDiv.appendChild(secDiv);
        });

        container.appendChild(colDiv);
      });

      // Week in hindsight
      var weekList = document.getElementById("weekList");
      weekList.innerHTML = "";
      (data.week_in_hindsight || []).forEach(function(line) {
        var li = document.createElement("li");
        li.textContent = line;
        weekList.appendChild(li);
      });
    }

    loadHeadlines();
  </script>
</body>
</html>